@model MedicalTriageSystem.Models.ViewModels.PatientDashboardViewModel
@{
    ViewData["Title"] = "Tableau de Bord Patient";
}

<div class="container-fluid px-4">
    <!-- En-tête -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h2 mb-1">
                <i class="fas fa-user text-primary me-2"></i>
                Bonjour, @Model.PatientInfo?.Name !
            </h1>
            <p class="text-muted mb-0">Votre tableau de bord médical personnel</p>
        </div>
        <div class="d-flex gap-2">
            <a href="/Triage/Create" class="btn btn-primary">
                <i class="fas fa-plus me-2"></i>Nouveau Triage
            </a>
            <button id="refreshBtn" class="btn btn-outline-secondary">
                <i class="fas fa-sync-alt"></i>
            </button>
        </div>
    </div>

    <!-- Alertes urgentes -->
    @if (Model.UrgentCasesList != null && Model.UrgentCasesList.Any())
    {
        <div class="alert alert-danger alert-dismissible fade show mb-4" role="alert">
            <div class="d-flex align-items-center">
                <i class="fas fa-exclamation-triangle fa-2x me-3"></i>
                <div>
                    <h5 class="alert-heading mb-1">@Model.UrgentCasesList.Count cas urgent(s) nécessitant une attention</h5>
                    <p class="mb-0">Veuillez consulter un médecin dès que possible.</p>
                </div>
            </div>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <!-- Première ligne : Informations patient + Dernier triage -->
    <div class="row g-4 mb-4">
        <!-- Informations patient -->
        <div class="col-xl-4 col-lg-6">
            <div class="card medical-card h-100">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-user-circle me-2"></i>
                        Informations personnelles
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-flex align-items-center mb-4">
                        <div class="avatar-lg bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center me-3">
                            <i class="fas fa-user fa-2x text-primary"></i>
                        </div>
                        <div>
                            <h4 class="mb-0">@Model.PatientInfo?.Name</h4>
                            <p class="text-muted mb-0">Patient</p>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-6 mb-3">
                            <small class="text-muted d-block">Âge</small>
                            <strong>@Model.PatientInfo?.Age ans</strong>
                        </div>
                        <div class="col-6 mb-3">
                            <small class="text-muted d-block">Sexe</small>
                            <strong>@Model.PatientInfo?.Gender</strong>
                        </div>
                        <div class="col-6 mb-3">
                            <small class="text-muted d-block">Groupe sanguin</small>
                            <strong>@(string.IsNullOrEmpty(Model.PatientInfo?.BloodType) ? "Non spécifié" : Model.PatientInfo.BloodType)</strong>
                        </div>
                        <div class="col-6 mb-3">
                            <small class="text-muted d-block">ID Patient</small>
                            <strong>#@Model.PatientInfo?.Id</strong>
                        </div>
                    </div>

                    <div class="mt-3">
                        <small class="text-muted d-block">Allergies</small>
                        <p class="mb-1">@(string.IsNullOrEmpty(Model.PatientInfo?.Allergies) ? "Aucune allergie connue" : Model.PatientInfo.Allergies)</p>
                    </div>

                    <div class="mt-3">
                        <small class="text-muted d-block">Contact</small>
                        <div class="d-flex align-items-center mb-1">
                            <i class="fas fa-envelope text-muted me-2" style="width: 16px;"></i>
                            <span>@Model.PatientInfo?.Email</span>
                        </div>
                        <div class="d-flex align-items-center">
                            <i class="fas fa-phone text-muted me-2" style="width: 16px;"></i>
                            <span>@Model.PatientInfo?.Phone</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dernier triage -->
        <div class="col-xl-4 col-lg-6">
            <div class="card medical-card h-100 @(Model.LastTriageResult?.Level == "Urgent" || Model.LastTriageResult?.Level == "Élevé" ? "border-danger" : Model.LastTriageResult?.Level == "Moyen" ? "border-warning" : "border-success")">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-stethoscope me-2"></i>
                        Dernier résultat de triage
                    </h5>
                    @if (Model.LastTriageResult != null)
                    {
                        <span class="badge bg-@(Model.LastTriageResult.Level == "Urgent" || Model.LastTriageResult.Level == "Élevé" ? "danger" : Model.LastTriageResult.Level == "Moyen" ? "warning" : "success")">
                            @Model.LastTriageResult.Level
                        </span>
                    }
                </div>
                <div class="card-body">
                    @if (Model.LastTriageResult != null)
                    {
                        <div class="text-center mb-4">
                            <div class="position-relative d-inline-block">
                                <div class="score-circle @(Model.LastTriageResult.Score > 70 ? "score-high" : Model.LastTriageResult.Score > 40 ? "score-medium" : "score-low")">
                                    <span class="score-value">@Model.LastTriageResult.Score</span>
                                </div>
                                <div class="mt-2">
                                    <small class="text-muted">Score de triage</small>
                                </div>
                            </div>
                        </div>

                        <div class="mb-4">
                            <h6>Recommandation :</h6>
                            <p class="mb-0">@Model.LastTriageResult.Recommendation</p>
                        </div>

                        @if (!string.IsNullOrEmpty(Model.LastTriageResult.Symptoms))
                        {
                            <div class="mb-3">
                                <h6>Symptômes :</h6>
                                <p class="mb-0">@Model.LastTriageResult.Symptoms</p>
                            </div>
                        }

                        <div class="d-flex justify-content-between align-items-center mt-4 pt-3 border-top">
                            <div>
                                <small class="text-muted">
                                    <i class="far fa-calendar me-1"></i>
                                    @Model.LastTriageResult.CreatedAt.ToString("dd/MM/yyyy")
                                </small>
                            </div>
                            <a href="/Triage/History" class="btn btn-sm btn-outline-primary">
                                Voir l'historique
                            </a>
                        </div>
                    }
                    else
                    {
                        <div class="text-center py-5">
                            <i class="fas fa-stethoscope fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">Aucun triage récent</h5>
                            <p class="text-muted mb-4">Effectuez votre premier triage médical</p>
                            <a href="/Triage/Create" class="btn btn-primary">
                                <i class="fas fa-plus me-2"></i>Commencer un triage
                            </a>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Métriques de santé -->
        <div class="col-xl-4">
            <div class="card medical-card h-100">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-heartbeat me-2"></i>
                        Métriques de santé
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-6">
                            <div class="metric-card text-center p-3 bg-light rounded">
                                <i class="fas fa-heart fa-2x text-danger mb-2"></i>
                                <h3 class="mb-1">@Model.HealthMetrics?.HeartRate</h3>
                                <small class="text-muted">Battements/min</small>
                                <div class="mt-2">
                                    <small class="@(Model.HealthMetrics?.HeartRate > 100 ? "text-danger" : Model.HealthMetrics?.HeartRate < 60 ? "text-warning" : "text-success")">
                                        @(Model.HealthMetrics?.HeartRate > 100 ? "Élevé" : Model.HealthMetrics?.HeartRate < 60 ? "Bas" : "Normal")
                                    </small>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="metric-card text-center p-3 bg-light rounded">
                                <i class="fas fa-tint fa-2x text-primary mb-2"></i>
                                <h3 class="mb-1">@Model.HealthMetrics?.BloodPressure</h3>
                                <small class="text-muted">mmHg</small>
                                <div class="mt-2">
                                    <small class="@(Model.HealthMetrics?.BloodPressure > 140 ? "text-danger" : Model.HealthMetrics?.BloodPressure < 90 ? "text-warning" : "text-success")">
                                        @(Model.HealthMetrics?.BloodPressure > 140 ? "Élevé" : Model.HealthMetrics?.BloodPressure < 90 ? "Bas" : "Normal")
                                    </small>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="metric-card text-center p-3 bg-light rounded">
                                <i class="fas fa-thermometer-half fa-2x text-warning mb-2"></i>
                                <h3 class="mb-1">@Model.HealthMetrics?.Temperature</h3>
                                <small class="text-muted">°C</small>
                                <div class="mt-2">
                                    <small class="@(Model.HealthMetrics?.Temperature > 37.5 ? "text-danger" : Model.HealthMetrics?.Temperature < 36 ? "text-warning" : "text-success")">
                                        @(Model.HealthMetrics?.Temperature > 37.5 ? "Fièvre" : Model.HealthMetrics?.Temperature < 36 ? "Bas" : "Normal")
                                    </small>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="metric-card text-center p-3 bg-light rounded">
                                <i class="fas fa-lungs fa-2x text-success mb-2"></i>
                                <h3 class="mb-1">@Model.HealthMetrics?.OxygenSaturation%</h3>
                                <small class="text-muted">Saturation O₂</small>
                                <div class="mt-2">
                                    <small class="@(Model.HealthMetrics?.OxygenSaturation < 95 ? "text-danger" : "text-success")">
                                        @(Model.HealthMetrics?.OxygenSaturation < 95 ? "Bas" : "Normal")
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-4 pt-3 border-top">
                        <small class="text-muted">
                            <i class="fas fa-info-circle me-1"></i>
                            Dernière mise à jour : @DateTime.Now.ToString("dd/MM/yyyy HH:mm")
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Deuxième ligne : Statistiques -->
    <div class="row g-4 mb-4">
        @{
            var statCards = new[]
            {
                new { Icon = "fas fa-stethoscope", Color = "primary", Value = Model.PatientStats?.TotalTriages ?? 0, Label = "Triage(s)", BgColor = "bg-primary" },
                new { Icon = "fas fa-calendar-check", Color = "success", Value = Model.PatientStats?.UpcomingAppointmentsCount ?? 0, Label = "RDV à venir", BgColor = "bg-success" },
                new { Icon = "fas fa-file-medical", Color = "info", Value = Model.PatientStats?.MedicalRecordsCount ?? 0, Label = "Dossiers médicaux", BgColor = "bg-info" },
                new { Icon = "fas fa-prescription-bottle", Color = "warning", Value = Model.PatientStats?.PrescriptionsCount ?? 0, Label = "Ordonnances", BgColor = "bg-warning" },
                new { Icon = "fas fa-heartbeat", Color = "danger", Value = Model.PatientStats?.TotalSymptoms ?? 0, Label = "Symptômes", BgColor = "bg-danger" },
                new { Icon = "fas fa-exclamation-triangle", Color = "dark", Value = Model.PatientStats?.UrgentCasesCount ?? 0, Label = "Cas urgents", BgColor = "bg-dark" }
                };
        }

        @foreach (var stat in statCards)
        {
            <div class="col-xl-2 col-md-4 col-sm-6">
                <div class="card medical-card h-100">
                    <div class="card-body text-center p-3">
                        <div class="@stat.BgColor bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
                            <i class="@stat.Icon fa-2x text-@stat.Color"></i>
                        </div>
                        <h2 class="mb-1">@stat.Value</h2>
                        <p class="text-muted mb-0">@stat.Label</p>
                        @if (stat.Value > 0)
                        {
                            <small class="text-@stat.Color mt-2 d-block">
                                <i class="fas fa-chart-line me-1"></i>
                                @if (stat.Label.Contains("Triage"))
                                {
                                    <span>Dernier: @Model.LastTriageResult?.CreatedAt.ToString("dd/MM")</span>
                                }
                                else if (stat.Label.Contains("RDV"))
                                {
                                    <span>Prochain: @Model.UpcomingAppointments?.FirstOrDefault()?.Date.ToString("dd/MM")</span>
                                }
                            </small>
                        }
                    </div>
                </div>
            </div>
        }
    </div>

    <!-- Troisième ligne : RDV à venir et Symptômes -->
    <div class="row g-4">
        <!-- RDV à venir -->
        <div class="col-lg-6">
            <div class="card medical-card h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-calendar-alt me-2"></i>
                        Rendez-vous à venir
                    </h5>
                    <a href="/Appointments" class="btn btn-sm btn-outline-primary">
                        Voir tous
                    </a>
                </div>
                <div class="card-body">
                    @if (Model.UpcomingAppointments != null && Model.UpcomingAppointments.Any())
                    {
                        <div class="list-group list-group-flush">
                            @foreach (var appointment in Model.UpcomingAppointments.OrderBy(a => a.Date).ThenBy(a => a.StartTime).Take(6))
                            {
                                <div class="list-group-item border-0 px-0 py-3">
                                    <div class="d-flex align-items-center">
                                        <div class="flex-shrink-0">
                                            <div class="date-badge bg-light rounded text-center p-2 me-3">
                                                <div class="text-primary fw-bold">@appointment.Date.ToString("dd")</div>
                                                <div class="text-muted small">@appointment.Date.ToString("MMM")</div>
                                            </div>
                                        </div>
                                        <div class="flex-grow-1">
                                            <div class="d-flex justify-content-between align-items-start">
                                                <div>
                                                    <h6 class="mb-1">@appointment.Reason</h6>
                                                    <small class="text-muted">
                                                        <i class="fas fa-user-md me-1"></i>
                                                        @appointment.Doctor?.Name
                                                        @if (!string.IsNullOrEmpty(appointment.Doctor?.Specialty))
                                                        {
                                                            <span> - @appointment.Doctor.Specialty</span>
                                                        }
                                                    </small>
                                                </div>
                                                <div class="text-end">
                                                    <div class="fw-bold">@appointment.StartTime?.ToString(@"hh\:mm")</div>
                                                    <span class="badge bg-@(appointment.Status == "Confirmed" ? "success" : appointment.Status == "Pending" ? "warning" : "secondary")">
                                                        @appointment.Status
                                                    </span>
                                                </div>
                                            </div>
                                            @if (!string.IsNullOrEmpty(appointment.Notes))
                                            {
                                                <div class="mt-2">
                                                    <small class="text-muted">@appointment.Notes</small>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <div class="text-center py-5">
                            <i class="fas fa-calendar-times fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">Aucun rendez-vous à venir</h5>
                            <p class="text-muted mb-4">Prenez rendez-vous avec un médecin</p>
                            <a href="/Appointments/Create" class="btn btn-primary">
                                <i class="fas fa-plus me-2"></i>Prendre RDV
                            </a>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Symptômes récents -->
        <div class="col-lg-6">
            <div class="card medical-card h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-heartbeat me-2"></i>
                        Symptômes récents
                    </h5>
                    <a href="/Symptoms" class="btn btn-sm btn-outline-primary">
                        Voir tous
                    </a>
                </div>
                <div class="card-body">
                    @if (Model.RecentSymptoms != null && Model.RecentSymptoms.Any())
                    {
                        <div class="list-group list-group-flush">
                            @foreach (var symptom in Model.RecentSymptoms.OrderByDescending(s => s.Date).Take(6))
                            {
                                <div class="list-group-item border-0 px-0 py-3">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <h6 class="mb-1">@symptom.Name</h6>
                                            @if (!string.IsNullOrEmpty(symptom.Description))
                                            {
                                                <p class="mb-1 small text-muted">@symptom.Description</p>
                                            }
                                            <div class="d-flex gap-3 mt-2">
                                                @if (symptom.Date != default)
                                                {
                                                    <small class="text-muted">
                                                        <i class="far fa-calendar me-1"></i>
                                                        @symptom.Date.ToString("dd/MM/yyyy")
                                                    </small>
                                                }
                                                @if (!string.IsNullOrEmpty(symptom.Location))
                                                {
                                                    <small class="text-muted">
                                                        <i class="fas fa-map-marker-alt me-1"></i>
                                                        @symptom.Location
                                                    </small>
                                                }
                                                @if (!string.IsNullOrEmpty(symptom.Duration))
                                                {
                                                    <small class="text-muted">
                                                        <i class="far fa-clock me-1"></i>
                                                        @symptom.Duration
                                                    </small>
                                                }
                                            </div>
                                        </div>
                                        <div>
                                            <div class="severity-indicator severity-@(symptom.Severity)">
                                                <span class="severity-value">@symptom.Severity</span>
                                                <small class="d-block text-center">/10</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <div class="text-center py-5">
                            <i class="fas fa-heartbeat fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">Aucun symptôme enregistré</h5>
                            <p class="text-muted mb-4">Enregistrez vos symptômes pour un suivi médical</p>
                            <a href="/Symptoms/Create" class="btn btn-primary">
                                <i class="fas fa-plus me-2"></i>Ajouter un symptôme
                            </a>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Quatrième ligne : Médecins disponibles -->
    @if (Model.DoctorAvailability != null && Model.DoctorAvailability.Any())
    {
        <div class="row g-4 mt-4">
            <div class="col-12">
                <div class="card medical-card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-user-md me-2"></i>
                            Médecins disponibles
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            @foreach (var doctor in Model.DoctorAvailability.Where(d => d.IsAvailable).Take(4))
                            {
                                <div class="col-xl-3 col-lg-6">
                                    <div class="doctor-card card h-100 border">
                                        <div class="card-body text-center">
                                            <div class="doctor-avatar bg-primary bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                                                <i class="fas fa-user-md fa-2x text-primary"></i>
                                            </div>
                                            <h5 class="mb-1">@doctor.Name</h5>
                                            <p class="text-muted mb-2">@doctor.Specialty</p>

                                            @if (!string.IsNullOrEmpty(doctor.Qualifications))
                                            {
                                                <p class="small mb-2">@doctor.Qualifications</p>
                                            }

                                            <div class="mb-3">
                                                <span class="badge bg-success">
                                                    <i class="fas fa-check-circle me-1"></i>Disponible
                                                </span>
                                            </div>

                                            <div class="doctor-info small text-muted mb-3">
                                                @if (!string.IsNullOrEmpty(doctor.Availability))
                                                {
                                                    <div class="mb-1">
                                                        <i class="far fa-clock me-1"></i>
                                                        @doctor.Availability
                                                    </div>
                                                }
                                                @if (!string.IsNullOrEmpty(doctor.ConsultationFee))
                                                {
                                                    <div>
                                                        <i class="fas fa-euro-sign me-1"></i>
                                                        @doctor.ConsultationFee
                                                    </div>
                                                }
                                            </div>

                                            <div class="d-grid gap-2">
                                                <a href="/Appointments/Create?doctorId=@doctor.Id" class="btn btn-sm btn-primary">
                                                    <i class="fas fa-calendar-plus me-1"></i>Prendre RDV
                                                </a>
                                                <a href="/Doctors/Details/@doctor.Id" class="btn btn-sm btn-outline-secondary">
                                                    <i class="fas fa-info-circle me-1"></i>Profil
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
</div>

@section Styles {
    <style>
        .medical-card {
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            border: 1px solid #e9ecef;
        }

            .medical-card:hover {
                box-shadow: 0 5px 20px rgba(0,0,0,0.1);
                transform: translateY(-2px);
            }

            .medical-card.border-left-primary {
                border-left: 4px solid #1a73e8 !important;
            }

            .medical-card.border-left-success {
                border-left: 4px solid #34a853 !important;
            }

            .medical-card.border-left-warning {
                border-left: 4px solid #f9ab00 !important;
            }

            .medical-card.border-left-danger {
                border-left: 4px solid #ea4335 !important;
            }

        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            border: 8px solid;
            font-weight: bold;
        }

            .score-circle.score-high {
                border-color: #ea4335;
                color: #ea4335;
            }

            .score-circle.score-medium {
                border-color: #f9ab00;
                color: #f9ab00;
            }

            .score-circle.score-low {
                border-color: #34a853;
                color: #34a853;
            }

        .score-value {
            font-size: 2.5rem;
            font-weight: 700;
        }

        .severity-indicator {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }

        .severity-10, .severity-9, .severity-8 {
            background: linear-gradient(135deg, #ea4335, #f9ab00);
        }

        .severity-7, .severity-6, .severity-5 {
            background: linear-gradient(135deg, #f9ab00, #fbbc04);
        }

        .severity-4, .severity-3, .severity-2 {
            background: linear-gradient(135deg, #34a853, #0b8043);
        }

        .severity-1 {
            background: linear-gradient(135deg, #e8eaed, #dadce0);
            color: #5f6368 !important;
        }

        .severity-value {
            font-size: 1.2rem;
            line-height: 1;
        }

        .metric-card {
            transition: all 0.3s ease;
        }

            .metric-card:hover {
                transform: translateY(-3px);
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            }

        .date-badge {
            width: 60px;
            transition: all 0.3s ease;
        }

            .date-badge:hover {
                background: #1a73e8 !important;
                color: white !important;
            }

        .doctor-card {
            transition: all 0.3s ease;
        }

            .doctor-card:hover {
                box-shadow: 0 8px 25px rgba(0,0,0,0.15);
                border-color: #1a73e8;
            }

        .doctor-avatar {
            transition: all 0.3s ease;
        }

        .doctor-card:hover .doctor-avatar {
            background: #1a73e8 !important;
        }

            .doctor-card:hover .doctor-avatar i {
                color: white !important;
            }
    </style>
}

@section Scripts {
    <script>
        $(document).ready(function() {
            console.log('Patient Dashboard loaded');

            // Actualisation des données
            $('#refreshBtn').click(function() {
                const $btn = $(this);
                $btn.prop('disabled', true).html('<span class="spinner-border spinner-border-sm me-2"></span>Actualisation...');

                setTimeout(() => {
                    location.reload();
                }, 1000);
            });

            // Mettre à jour l'heure en temps réel
            function updateCurrentTime() {
                const now = new Date();
                const timeStr = now.toLocaleTimeString('fr-FR', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                const dateStr = now.toLocaleDateString('fr-FR', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });

                $('.current-time').text(timeStr);
                $('.current-date').text(dateStr);
            }

            // Mettre à jour toutes les 30 secondes
            setInterval(updateCurrentTime, 30000);

            // Initialiser l'heure
            updateCurrentTime();

            // Animation des cartes de statistiques
            $('.metric-card').each(function(index) {
                $(this).css('animation-delay', (index * 0.1) + 's');
            });

            // Gestion des alertes
            $('.alert').on('closed.bs.alert', function () {
                console.log('Alert closed');
            });

            // Mise à jour périodique des métriques (simulation)
            setInterval(function() {
                // Simuler une mise à jour des métriques de santé
                const heartRate = 70 + Math.floor(Math.random() * 10);
                const bloodPressure = 120 + Math.floor(Math.random() * 5);
                const temperature = 36.5 + (Math.random() * 0.5);
                const oxygen = 96 + Math.floor(Math.random() * 3);

                // Mettre à jour l'affichage (simulation)
                $('.metric-card:first h3').text(heartRate);
                $('.metric-card:eq(1) h3').text(bloodPressure);
                $('.metric-card:eq(2) h3').text(temperature.toFixed(1));
                $('.metric-card:last h3').text(oxygen + '%');

                // Mettre à jour les indicateurs
                updateHealthIndicators(heartRate, bloodPressure, temperature, oxygen);
            }, 30000); // Toutes les 30 secondes

            function updateHealthIndicators(hr, bp, temp, oxy) {
                // Mettre à jour les classes des indicateurs
                const hrClass = hr > 100 ? 'text-danger' : hr < 60 ? 'text-warning' : 'text-success';
                const bpClass = bp > 140 ? 'text-danger' : bp < 90 ? 'text-warning' : 'text-success';
                const tempClass = temp > 37.5 ? 'text-danger' : temp < 36 ? 'text-warning' : 'text-success';
                const oxyClass = oxy < 95 ? 'text-danger' : 'text-success';

                $('.metric-card:first small').removeClass('text-danger text-warning text-success').addClass(hrClass);
                $('.metric-card:eq(1) small').removeClass('text-danger text-warning text-success').addClass(bpClass);
                $('.metric-card:eq(2) small').removeClass('text-danger text-warning text-success').addClass(tempClass);
                $('.metric-card:last small').removeClass('text-danger text-success').addClass(oxyClass);
            }

            // Tooltips
            $('[data-bs-toggle="tooltip"]').tooltip();

            // Contrôle des animations
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate__animated', 'animate__fadeInUp');
                    }
                });
            }, { threshold: 0.1 });

            // Observer les éléments à animer
            document.querySelectorAll('.card, .metric-card').forEach(el => {
                observer.observe(el);
            });
        });
    </script>
}